{
  "name": "mongodb-source-posts-connector",
  "config": {
    "connector.class": "com.mongodb.kafka.connect.MongoSourceConnector",
    "tasks.max": "1",
    "connection.uri": "mongodb://admin:admin@192.168.0.10:27017,192.168.0.10:27018,192.168.0.10:27019/mydatabase?replicaSet=rs0",
    "database": "mydatabase",
    "collection": "posts",
    "topic.prefix": "search",
    "copy.existing": "true",
    "key.converter": "org.apache.kafka.connect.json.JsonConverter",
    "key.converter.schemas.enable": "true",
    "output.format.key": "schema",
    "value.converter": "org.apache.kafka.connect.json.JsonConverter",
    "value.converter.schemas.enable": "true",
    "output.format.value": "schema",
    "output.json.formatter": "com.mongodb.kafka.connect.source.json.formatter.SimplifiedJson",
    "output.schema.key": "{\"type\":\"record\",\"name\":\"PostKey\",\"namespace\":\"com.mynodeapp\",\"fields\":[{\"name\":\"documentKey\",\"type\":{\"type\":\"record\",\"name\":\"DocumentKeyRecord\",\"fields\":[{\"name\":\"_id\",\"type\":\"string\"}]}}]}",
    "output.schema.value": "{\"type\":\"record\",\"name\":\"PostValue\",\"namespace\":\"com.mynodeapp\",\"fields\":[{\"name\":\"_id\",\"type\":{\"type\":\"record\",\"name\":\"IdWrapper\",\"fields\":[{\"name\":\"_id\",\"type\":[\"null\",\"string\"]},{\"name\":\"copyingData\",\"type\":[\"null\",\"string\"]},{\"name\":\"_data\",\"type\":[\"null\",\"string\"]}]}},{\"name\":\"documentKey\",\"type\":{\"type\":\"record\",\"name\":\"DocumentKeyRecord\",\"fields\":[{\"name\":\"_id\",\"type\":\"string\"}]}},{\"name\":\"fullDocument\",\"type\":{\"type\":\"record\",\"name\":\"FullDocumentRecord\",\"fields\":[{\"name\":\"body\",\"type\":\"string\"},{\"name\":\"time\",\"type\":\"long\"}]}}]}",
    "pipeline": "[{\"$project\":{\"fullDocument._id\":0, \"fullDocument.userid\": 0, \"fullDocument.__v\": 0, \"operationType\": 0, \"clusterTime\": 0, \"wallTime\": 0}}]",
    "transforms": "flattenKey,extractKey,flattenValue,renameValue,filterValue",
    "transforms.flattenKey.type": "org.apache.kafka.connect.transforms.Flatten$Key",
    "transforms.flattenKey.delimiter": ".",
    "transforms.extractKey.type": "org.apache.kafka.connect.transforms.ExtractField$Key",
    "transforms.extractKey.field": "documentKey._id",
    "transforms.flattenValue.type": "org.apache.kafka.connect.transforms.Flatten$Value",
    "transforms.flattenValue.delimiter": ".",
    "transforms.renameValue.type": "org.apache.kafka.connect.transforms.ReplaceField$Value",
    "transforms.renameValue.renames": "fullDocument.body:body,fullDocument.time:time,documentKey._id:mongo_id",
    "transforms.filterValue.type": "org.apache.kafka.connect.transforms.ReplaceField$Value",
    "transforms.filterValue.whitelist": "mongo_id,body,time"
  }
}

# This file: https://docs.confluent.io/platform/7.7/installation/configuration/connect/source-connect-configs.html

# MongoDB connector:
# https://www.mongodb.com/docs/kafka-connector/current/quick-start/

# Converter
# https://www.confluent.io/blog/kafka-connect-deep-dive-converters-serialization-explained/

# Transform
# https://docs.confluent.io/platform/current/connect/transforms/extractfield.html
# https://docs.confluent.io/cloud/current/connectors/single-message-transforms.html#extract-field

# Mongodb sends:
# {"_id": {"_data": "8266DDC9EA000000012B042C0100296E5A100446A0DA9A0E25466AB0C69B813650170E463C6F7065726174696F6E54797065003C696E736572740046646F63756D656E744B65790046645F6964006466DDC9EA89BC887A1AE93BD3000004"}, "fullDocument": {"body": "New Post with old vibe8", "time": 123},"ns": {"db": "mydatabase", "coll": "posts"}, "documentKey": {"_id": {"$oid": "66ddc9ea89bc887a1ae93bd3"}}} 

# Kafka stores:
# {"schema":{"type":"string","optional":false},"payload":"66e5624189bc887a1ae93bf7"} 
# {"schema":{"type":"struct","fields":[{"type":"string","optional":false,"field":"mongo_id"},{"type":"string","optional":false,"field":"body"},{"type":"int64","optional":false,"field":"time"},{"type":"string","optional":false,"field":"collection"}],"optional":false,"name":"com.mynodeapp.PostValue"},"payload":{"mongo_id":"66e55f5b89bc887a1ae93bf1","body":"New Post with old vibe16","time":123,"collection":"posts"}}