{
  "name": "mongodb-source-users-connector",
  "config": {
    "connector.class": "com.mongodb.kafka.connect.MongoSourceConnector",
    "tasks.max": "1",
    "connection.uri": "mongodb://admin:admin@127.0.0.1:27017,127.0.0.1:27018,127.0.0.1:27019/mydatabase?replicaSet=rs0",
    "database": "mydatabase",
    "collection": "users",
    "topic.prefix": "search",
    "copy.existing": "true",
    "key.converter": "org.apache.kafka.connect.json.JsonConverter",
    "key.converter.schemas.enable": "true",
    "output.format.key": "schema",
    "value.converter": "org.apache.kafka.connect.json.JsonConverter",
    "value.converter.schemas.enable": "true",
    "output.format.value": "schema",
    "output.json.formatter": "com.mongodb.kafka.connect.source.json.formatter.SimplifiedJson",
    "output.schema.key": "{\"type\":\"record\",\"name\":\"UserKey\",\"namespace\":\"com.mynodeapp\",\"fields\":[{\"name\":\"documentKey\",\"type\":{\"type\":\"record\",\"name\":\"DocumentKeyRecord\",\"fields\":[{\"name\":\"_id\",\"type\":\"string\"}]}}]}",
    "output.schema.value": "{\"type\":\"record\",\"name\":\"UserValue\",\"namespace\":\"com.mynodeapp\",\"fields\":[{\"name\":\"_id\",\"type\":{\"type\":\"record\",\"name\":\"IdWrapper\",\"fields\":[{\"name\":\"_id\",\"type\":[\"null\",\"string\"]},{\"name\":\"copyingData\",\"type\":[\"null\",\"string\"]},{\"name\":\"_data\",\"type\":[\"null\",\"string\"]}]}},{\"name\":\"documentKey\",\"type\":{\"type\":\"record\",\"name\":\"DocumentKeyRecord\",\"fields\":[{\"name\":\"_id\",\"type\":\"string\"}]}},{\"name\":\"fullDocument\",\"type\":{\"type\":\"record\",\"name\":\"FullDocumentRecord\",\"fields\":[{\"name\":\"username\",\"type\":\"string\"},{\"name\":\"name\",\"type\":\"string\"},{\"name\":\"email\",\"type\":\"string\"}]}}]}",
    "pipeline": "[{\"$project\":{\"fullDocument._id\":0, \"fullDocument.birthYear\": 0, \"fullDocument.__v\": 0, \"operationType\": 0, \"clusterTime\": 0, \"wallTime\": 0}}]",
    "transforms": "flattenKey,extractKey,flattenValue,renameValue,filterValue",
    "transforms.flattenKey.type": "org.apache.kafka.connect.transforms.Flatten$Key",
    "transforms.flattenKey.delimiter": ".",
    "transforms.extractKey.type": "org.apache.kafka.connect.transforms.ExtractField$Key",
    "transforms.extractKey.field": "documentKey._id",
    "transforms.flattenValue.type": "org.apache.kafka.connect.transforms.Flatten$Value",
    "transforms.flattenValue.delimiter": ".",
    "transforms.renameValue.type": "org.apache.kafka.connect.transforms.ReplaceField$Value",
    "transforms.renameValue.renames": "fullDocument.username:username,fullDocument.name:name,fullDocument.email:email,documentKey._id:mongo_id",
    "transforms.filterValue.type": "org.apache.kafka.connect.transforms.ReplaceField$Value",
    "transforms.filterValue.whitelist": "mongo_id,username,name,email"
  }
}


# This file: https://docs.confluent.io/platform/7.7/installation/configuration/connect/source-connect-configs.html

# MongoDB connector:
# https://www.mongodb.com/docs/kafka-connector/current/quick-start/

# Converter
# https://www.confluent.io/blog/kafka-connect-deep-dive-converters-serialization-explained/

# Transform
# https://docs.confluent.io/platform/current/connect/transforms/extractfield.html
# https://docs.confluent.io/cloud/current/connectors/single-message-transforms.html#extract-field

# Kafka stores:
# key: {"schema":{"type":"string","optional":false},"payload":"66cd058f6b3f7dc8911b0062"} 
# value: {"schema":{"type":"struct","fields":[{"type":"string","optional":false,"field":"mongo_id"},{"type":"string","optional":false,"field":"username"},{"type":"string","optional":false,"field":"name"},{"type":"string","optional":false,"field":"email"}],"optional":false,"name":"com.mynodeapp.UserValue"},"payload":{"mongo_id":"66cd058f6b3f7dc8911b0062","username":"tareqjoy","name":"Tareq Joy","email":"haha@gmail.com"}}


